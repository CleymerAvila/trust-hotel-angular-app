<div class="flex flex-col m-2 p-2 overflow-y-hidden overflow-x-hidden">
  <h4 class="font-bold text-2xl text-slate-500">Reservaciones </h4>
  <div class="flex gap-4 justify-between mt-6">
    <div>
      <label for="input-group-1" class="sr-only">Search</label>
      <div class="relative ">
          <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
              <svg class="w-4 h-4 text-body" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/></svg>
          </div>
          <input type="text" id="input-group-1" class="block w-full max-w-96 ps-9 pe-3 py-2 bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-2xl focus:ring-brand focus:border-brand shadow-xs placeholder:text-body" placeholder="Search">
      </div>
    </div>
    <div class="flex flex-row gap-5">
      <button [routerLink]="['make-booking']" class="bg-blue-500 hover:bg-blue-700 cursor-pointer text-white font-bold py-2 px-4 rounded mb-4 mt-2">
        Agregar Reserva
      </button>
      <button (click)="toggleDropdown()" id="dropdownDefaultButton" data-dropdown-toggle="dropdown" class=" inline-flex items-center justify-center text-body bg-white/40 box-border border  hover:text-heading active:border-sky-300 shadow-xs font-medium leading-5 rounded text-sm px-3 py-2 mb-4 mt-2" type="button">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 2.5C12.2958 2.5 14.5458 2.69334 16.7358 3.065C17.18 3.14 17.5 3.52834 17.5 3.97834V4.84834C17.5 5.09456 17.4515 5.33838 17.3573 5.56587C17.2631 5.79336 17.1249 6.00006 16.9508 6.17417L12.4242 10.7008C12.2501 10.8749 12.1119 11.0816 12.0177 11.3091C11.9235 11.5366 11.875 11.7804 11.875 12.0267V14.4658C11.8751 14.8141 11.7781 15.1556 11.595 15.4519C11.4119 15.7482 11.1499 15.9876 10.8383 16.1433L8.125 17.5V12.0267C8.125 11.7804 8.07651 11.5366 7.98228 11.3091C7.88805 11.0816 7.74994 10.8749 7.57583 10.7008L3.04917 6.17417C2.87506 6.00006 2.73695 5.79336 2.64272 5.56587C2.54849 5.33838 2.5 5.09456 2.5 4.84834V3.97834C2.5 3.52834 2.82 3.14 3.26417 3.065C5.48964 2.68821 7.74286 2.49921 10 2.5Z" stroke="#667085" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
          Filter by
        <svg class="w-4 h-4 ms-1.5 -me-0.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
      </button>
      <!-- Dropdown menu -->
     @if(isOpen()){
       <div id="dropdown" class="z-10 origin-bottom-right absolute right-6 bg-white border border-default-medium rounded-xl shadow-lg w-32 focus:outline-none mt-12">
           <ul class="p-2 text-sm text-body font-medium" aria-labelledby="dropdownDefaultButton">
           <li>
               <a href="#" class="inline-flex items-center w-full p-2 hover:bg-neutral-tertiary-medium hover:text-heading rounded">Color</a>
           </li>
           <li>
               <a href="#" class="inline-flex items-center w-full p-2 hover:bg-neutral-tertiary-medium hover:text-heading rounded">Category</a>
           </li>
           <li>
               <a href="#" class="inline-flex items-center w-full p-2 hover:bg-neutral-tertiary-medium hover:text-heading rounded">Price</a>
           </li>
           <li>
               <a href="#" class="inline-flex items-center w-full p-2 hover:bg-neutral-tertiary-medium hover:text-heading rounded">Sign out</a>
           </li>
           </ul>
       </div>
     }
    </div>

  </div>

  @if(loading()){
    <p>Cargando Reservas...</p>
  }

  @if(error()){
    <p>Error al cargar las Reservaciones</p>
    <div>
      <button (click)="loadBookings()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4 mt-2">
        Reintentar
      </button>
    </div>
  }

  @if(!loading() && !error()){
    @if(bookings().length === 0){
      <p>No hay Reservaciones disponibles.</p>
      <p>Por favor asegurate de registrar nuevas</p>
    } @else {
      <!-- cargamos las bookinges aquÃ­-->
      <div class="relative overflow-x-auto bg-neutral-primary-soft shadow-xs rounded">
        <table class="w-full text-sm text-left rtl:text-right text-body">
          <thead class="bg-blue-200/90 text-sm text-body bg-neutral-secondary-medium border-b-blue-900 border-default-medium">
            <tr>
              <th scope="col" class="px-6 py-3 font-medium">
                ID
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                #Habitacion
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Cliente
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Fecha Inicio
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Fecha Fin
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Estado
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Anticipo
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                Factura
              </th>
              <th scope="col" class="px-6 py-3 font-medium">
                CheckIn
              </th>
              <th scope="col" class="px-6 py-3 font-medium text-right">
                Acciones
              </th>
            </tr>
          </thead>

          <!-- Justo aqui en el body hacemos la iteracion de las Empleados-->
          <tbody>
            @for(booking of bookings() ; track booking.bookingId){
              <tr class="bg-white bg-neutral-primary-soft border-b border-b-black/20 hover:bg-neutral-secondary-medium">
                <th scope="row" class="px-6 py-4 font-medium text-heading whitespace-nowrap">
                  {{ booking.bookingId}}
                </th>
                <td class="px-6 py-4">
                  {{ booking.roomNumber}}
                </td>
                <td class="px-6 py-4">
                  {{ booking.clientName }}
                </td>
                <td class="px-6 py-4">
                  {{ booking.startDate | date:'dd.MM.yy' }}
                </td>
                <td class="px-6 py-4">
                  {{ booking.endDate  | date:'dd.MM.yy' }}
                </td>
                <td class="px-6 py-4">
                  {{ booking.status}}
                </td>
                <td class="px-6 py-4">
                  ${{ booking.advanceDeposit }}
                </td>
                <td class="px-6 py-4 bg-blue-300 hover:cursor-pointer" (click)="redirecToInvoice(booking.invoiceId)">
                  $ ðŸ“„
                </td>
                <td class="px-6 py-4 hover:cursor-pointer">
                  <button type="button" (click)="confirmCheckIn(booking.bookingId)" class="border-green-300 border-2 p-1 rounded-2xl hover:cursor-pointer hover:bg-green-400 hover:text-white text-xs font-bold"> Check in</button>
                </td>
                <td class="px-6 py-4 text-right flex gap-4 justify-start">
                  <!-- <a [routerLink]="['/']" class="text-blue-500 font-medium text-fg-brand hover:underline">Detalles</a> -->
                  <a (click)="checkIn(booking.bookingId)" class="text-blue-500 font-medium text-fg-brand hover:underline">Generar Factura</a>
                  <a (click)="cancelBooking(booking.bookingId)" class="text-red-600 font-medium text-fg-brand hover:underline">Cancel</a>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  }
</div>
